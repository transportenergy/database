# N.B. this file configures Travis to test *both* the Python and R item codes.
#
# References:
# - The Travis documentation: https://docs.travis-ci.com/
# - Example .travis.yml for a popular R package:
#   https://github.com/tidyverse/ggplot2/blob/master/.travis.yml
# - The community-developed R support for Travis:
#   - https://github.com/travis-ci/travis-build , in particular the file:
#     lib/travis/build/script/r.rb
#   - Example output: https://travis-ci.org/tidyverse/ggplot2/jobs/232365761

dist: xenial

language: r

cache:
  directories:
    - $HOME/.cache/pip
    - $HOME/R/Library

r: release

addons:
  apt:
    packages:
    # Python 3
    - python3-pip
    - python3-setuptools
    # For git2r
    - libgit2-dev

before_install:
  # - Rscript -e "install.packages('devtools', lib='$R_LIBS_USER')"
  - which -a pip
  - which -a pip3
  - pip3 install --verbose --upgrade pip
  - which -a pip
  - which -a pip3
  - cat /home/travis/.local/bin/pip3
  - python3 -c "import sys; print(sys.path)"

install:
  - pip3 install python/
  - pip3 install -r ci/requirements.txt
  - Rscript -e "devtools::install('R/item', dep = T)"

script:
   - which -a py.test
   - py.test python/item --cov=item --cov-report term-missing
   - R CMD check R/item

after_success:
  - coverage combine
  - codecov

notifications:
  email: false
